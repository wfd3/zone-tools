.TH MKARPA3 1 "July 2025" "zone-tools" "User Commands"
.SH NAME
mkarpa3 \- generate DNS reverse zone files from forward zone files
.SH SYNOPSIS
.B mkarpa3
[\fB\-o\fR \fIoutput_file\fR]
[\fB\-d\fR \fIreverse_domain\fR]
[\fB\-s\fR]
[\fB\-h\fR]
\fIzone_file\fR [\fIzone_file\fR ...]
.SH DESCRIPTION
.B mkarpa3
reads one or more DNS forward zone files and generates a reverse zone file
containing PTR records for all A records found. The program uses the zoneparser
library to parse DNS zone files, including support for $GENERATE directives,
$INCLUDE files, and various DNS record types.

The program automatically extracts SOA information from the first zone file
processed and uses it to generate the reverse zone's SOA record. It converts
A records to PTR records in the appropriate reverse zones and processes
$GENERATE directives for bulk A record ranges.

.SH OPTIONS
.TP
.BR \-o " " \fIoutput_file\fR
Write output to \fIoutput_file\fR instead of standard output.
.TP
.BR \-d " " \fIreverse_domain\fR
Specify an optional reverse domain to use in the output. If not specified,
the program will derive appropriate reverse zones from the IP addresses found.
.TP
.BR \-s
Sort reverse zones numerically by IP address. Without this flag, zones are
output in the order they were created during processing (preserving input order).
.TP
.BR \-h
Show help message and exit.

.SH FEATURES
.IP \(bu 2
Converts A records to PTR records in appropriate reverse zones
.IP \(bu 2
Processes $GENERATE directives for A records and converts them to PTR directives
.IP \(bu 2
Handles $INCLUDE files and marks file transitions with comments
.IP \(bu 2
Supports both input-order preservation and numerical IP address sorting
.IP \(bu 2
Extracts SOA information from the first zone file processed
.IP \(bu 2
Automatically qualifies hostnames with the SOA domain
.IP \(bu 2
Excludes A records marked with ";inaddr" comments from PTR generation

.SH EXAMPLES
.PP
Generate a reverse zone file from a single forward zone:
.RS
.nf
mkarpa3 example.com.zone > reverse.zone
.fi
.RE

.PP
Generate reverse zone with sorted IP addresses and save to file:
.RS
.nf
mkarpa3 -s -o reverse.zone forward.zone
.fi
.RE

.PP
Process multiple zone files including those with $INCLUDE directives:
.RS
.nf
mkarpa3 -o reverse.zone main.zone secondary.zone
.fi
.RE

.SH INPUT FORMAT
The program expects standard DNS zone file format. It processes:
.IP \(bu 2
A records: converted to PTR records
.IP \(bu 2
SOA records: used to generate reverse zone SOA
.IP \(bu 2
NS records: used to identify nameservers
.IP \(bu 2
$GENERATE directives: converted from A record generation to PTR generation
.IP \(bu 2
$INCLUDE directives: processed recursively with comment marking

.PP
Example input with A records:
.RS
.nf
$TTL 86400
@    IN    SOA    ns.example.com. admin.example.com. (
                  2023010101 ; Serial
                  28800      ; Refresh
                  14400      ; Retry
                  3600000    ; Expire
                  86400 )    ; Minimum

     IN    NS     ns.example.com.

ns   IN    A      10.0.0.1
web  IN    A      10.0.0.10
mail IN    A      10.0.0.20

$GENERATE 100-199 host-$ IN A 10.0.1.$
.fi
.RE

.SH OUTPUT FORMAT
The program generates a complete reverse zone file with:
.IP \(bu 2
Header comments with generation timestamp and source files
.IP \(bu 2
$TTL directive
.IP \(bu 2
SOA record derived from input
.IP \(bu 2
NS records
.IP \(bu 2
$ORIGIN directives for each reverse zone
.IP \(bu 2
PTR records sorted by last octet
.IP \(bu 2
$GENERATE directives for bulk ranges

.PP
Example output:
.RS
.nf
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Reverse zone file for domain 'example.com.'
;
; DO NOT EDIT THIS FILE; it is programmatically updated
;
; Generated Sun Jul  6 13:28:16 PDT 2025 from:
;  host.example.com:/path/to/example.com.zone
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
$TTL 86400
@	IN	SOA	ns.example.com.	admin.example.com. (
				2023010101	 ; Serial
				28800		 ; Refresh
				14400		 ; Retry
				3600000		 ; Expire
				86400 )		 ; Minimum
	IN	NS	ns.example.com.

ns.example.com.		IN	A	10.0.0.1 ;inaddr

$ORIGIN 0.0.10.in-addr.arpa.
1		IN	PTR		ns.example.com.
10		IN	PTR		web.example.com.
20		IN	PTR		mail.example.com.
$ORIGIN 1.0.10.in-addr.arpa.
$GENERATE 100-199 $ IN PTR host-$.example.com.
.fi
.RE

.SH EXIT STATUS
.B mkarpa3
exits with status 0 on success, or 1 if an error occurs during processing.

.SH SEE ALSO
.BR named (8),
.BR named-checkzone (8),
.BR dig (1)

.SH AUTHOR
Part of the zone-tools suite for DNS zone file management.